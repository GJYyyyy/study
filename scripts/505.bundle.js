"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[505],{8505:(t,e,a)=>{a.r(e),a.d(e,{default:()=>o});var i=function(){var t=this,e=t._self._c;return e("div",[e("add-button",{attrs:{path:"/addKnowledgeCatalog",query:t.addtionQuery}}),t._v(" "),e("custom-list-head",{attrs:{title:"科目",value:t.cateTitle}}),t._v(" "),e("custom-tree",{attrs:{list:t.list,"child-list-path":"/listKnowledge","update-path":"/updateKnowledgeCatalog","add-path":"/addKnowledgeCatalog"},on:{delete:t.onDelete,expand:t.onExpand,loaded:t.onLoaded}}),t._v(" "),e("custom-search",{on:{search:t.onSearch}})],1)};i._withStripped=!0;var s=a(3308),d=a(1241),l=a(7632);const r="subject_id",n={components:{"add-button":l.HS,"custom-tree":l.Uh,"custom-search":l.Ny,"custom-list-head":l.K4},computed:{[r](){return this.$route.query.cate_id||this.$store.state.userInfo[r]},addtionQuery(){return{cate_id:this[r]}},expandCateId(){return this.$route.query.expand_cate_id},initFlag(){return this.$route.query.init}},data:()=>({cateTitle:"",list:[],listParams:{keyword:void 0,equalFields:{[r]:"",parent_id:"null"}},tree:void 0}),async mounted(){this.init()},activated(){if(this.tree&&this.expandCateId){let t=this.tree.find({data:{id:this.expandCateId}});t.expand(),t.select()}"1"===this.initFlag&&this.init()},methods:{async getList(){let t;(0,d.QP)();try{t=await s.Z.listNoPageKnowledgeCatalog(this.listParams)}catch(t){(0,d.Zk)()}return(0,d.Zk)(),t},async setList(){let t=await this.getList();this.list=this.formatterList(t.list)},async init(){let t;(0,d.QP)();try{t=await s.Z.detailSubject(this[r],{fields:["title","code"]})}catch(t){(0,d.Zk)()}this.cateTitle=t.data.code?`${t.data.title}(${t.data.code})`:t.data.title;let{listParams:e}=this;e.equalFields[r]=this[r],e.equalFields.parent_id="null",e.keyword=void 0,this.listParams={...e},this.list=[],this.setList()},formatterList(t){return t.sort(((t,e)=>t.create_date-e.create_date)).map((t=>({text:t.title,data:{id:t.knowledge_catalog_id,cate_id:this[r]},state:{expanded:!1},children:[{text:"...",data:{placeholder:!0}}]})))},onSearch(t){let{listParams:e}=this;e.keyword=""===t?void 0:t,e.equalFields.parent_id="null",this.listParams={...e},this.list=[],this.setList()},onDelete(t){(0,d.QP)(),s.Z.deleteTreeKnowledgeCatalog([t]).then((()=>{(0,d.Zk)(),this.$toast.success({message:"删除成功",onClose:()=>this.init()})}),(()=>(0,d.Zk)()))},async onExpand(t){if(t.children.length>0&&t.children[0].data.placeholder){let e,a={...this.listParams};a.keyword=void 0,a.equalFields.parent_id=t.data.id,t.children.find((t=>t.data.placeholder)).remove(),(0,d.QP)();try{e=await s.Z.listNoPageKnowledgeCatalog(a)}catch(t){(0,d.Zk)()}this.formatterList(e.list).forEach((e=>{t.append(e)})),(0,d.Zk)()}},onLoaded(t){this.tree=t}}},o=(0,a(1900).Z)(n,i,[],!1,null,null,null).exports}}]);