"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[51],{6051:(t,e,a)=>{a.r(e),a.d(e,{default:()=>r});var s=function(){var t=this,e=t._self._c;return e("div",[e("van-form",{on:{submit:t.onSubmit}},[e("van-field",{attrs:{value:t.subjectList[t.subjectListIndex]?.title,readonly:"","is-link":"",label:"科目",placeholder:"请选择科目",rules:[{required:!0,message:"请选择科目"}]},on:{click:t.onSubjectPopupShow}}),t._v(" "),e("van-field",{attrs:{label:"父目录",readonly:"",value:t.parent?.title??"无"}}),t._v(" "),e("van-field",{attrs:{name:"目录名",label:"目录名",placeholder:"目录名",rules:[{required:!0,message:"请填写目录名"}]},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}}),t._v(" "),e("div",{staticStyle:{margin:"16px"}},[e("van-button",{attrs:{round:"",block:"",type:"info",size:"small","native-type":"submit"}},[t._v("提交")])],1)],1),t._v(" "),e("div",{staticStyle:{margin:"16px"}},[e("van-button",{attrs:{round:"",block:"",type:"danger",size:"small"},on:{click:t.onDeleteKnowledgeCatalog}},[t._v("删除")])],1),t._v(" "),e("van-popup",{attrs:{position:"bottom"},model:{value:t.subjectPopupVisible,callback:function(e){t.subjectPopupVisible=e},expression:"subjectPopupVisible"}},[e("van-picker",{attrs:{title:"选择科目","show-toolbar":"","value-key":"title","default-index":t.subjectListIndex,columns:t.subjectList},on:{confirm:t.onSubjectConfirm,cancel:function(e){t.subjectPopupVisible=!1}}})],1)],1)};s._withStripped=!0;var i=a(2996),l=a(1241);const o="knowledge_catalog_id",n="subject_id",u={data:()=>({formData:{title:"",parent_id:"null",[n]:""},subjectPopupVisible:!1,subjectList:[],subjectListIndex:-1,parent:{}}),computed:{[o](){return this.$route.query.id}},async mounted(){let t=(await i.Z.listNoPageSubject({equalFields:{major_id:this.$store.state.subjectCate}})).list;this.subjectList=t;let e=await i.Z.detailKnowledgeCatalog(this[o]),{formData:a}=this;a.title=e.data.title,a[n]=e.data[n],a.parent_id=e.data.parent_id,this.formData={...a};let s=t.findIndex((t=>t[n]===e.data[n]));this.subjectListIndex=s;let l=await i.Z.detailKnowledgeCatalog(e.data.parent_id);this.parent=l.data},methods:{onSubmit(){let t={...this.formData};i.Z.updateKnowledgeCatalog(this[o],(0,l.mG)(t)).then((()=>{this.$toast.success({message:"更新成功",onClose:()=>this.$router.back()})}))},onDeleteKnowledgeCatalog(){this.$dialog.confirm({message:"确认删除"}).then((()=>{i.Z.deleteTreeKnowledgeCatalog([this[o]]).then((()=>{this.$toast.success({message:"删除成功",onClose:()=>this.$router.back()})}))}))},onSubjectPopupShow(){this.formData[n]&&-1!==this.subjectListIndex?this.$toast({message:"已指定父级，不能修改"}):this.subjectPopupVisible=!0},onSubjectConfirm(t,e){this.subjectListIndex=e,this.subjectPopupVisible=!1}}},r=(0,a(1900).Z)(u,s,[],!1,null,null,null).exports}}]);