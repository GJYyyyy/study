"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[803],{6803:(t,e,a)=>{a.r(e),a.d(e,{default:()=>r});var i=function(){var t=this,e=t._self._c;return e("div",[e("add-button",{attrs:{path:"/addKnowledgeCatalog",query:t.addtionQuery}}),t._v(" "),e("custom-list-head",{attrs:{title:"科目",value:t.cateTitle}}),t._v(" "),e("custom-tree",{attrs:{list:t.list,"child-list-path":"/listKnowledge","update-path":"/updateKnowledgeCatalog","add-path":"/addKnowledgeCatalog"},on:{delete:t.onDelete,expand:t.onExpand}}),t._v(" "),e("custom-search",{on:{search:t.onSearch}})],1)};i._withStripped=!0;var s=a(2996),l=a(248);const d="knowledge_catalog_id",o="subject_id",n={components:{"add-button":l.HS,"custom-tree":l.Uh,"custom-search":l.Ny,"custom-list-head":l.K4},computed:{[o](){return this.$route.query.cate_id||this.$store.state.userInfo[o]},addtionQuery(){return{cate_id:this[o]}}},data:()=>({cateTitle:"",list:[],listParams:{keyword:void 0,equalFields:{[o]:"",parent_id:"null"}}}),async mounted(){this.init()},methods:{async getList(){return await s.Z.listNoPageKnowledgeCatalog(this.listParams)},async setList(){let t=await this.getList();this.list=this.formatterList(t.list)},async init(){let t=await s.Z.detailSubject(this[o],{fields:["title","code"]});this.cateTitle=t.data.code?`${t.data.title}(${t.data.code})`:t.data.title;let{listParams:e}=this;e.equalFields[o]=this[o],e.equalFields.parent_id="null",e.keyword=void 0,this.listParams={...e},this.list=[],this.setList()},async formatterList(t){t=t.sort(((t,e)=>t.create_date-e.create_date));let e=[];for(let a=0;a<t.length;a++){let i=t[a],l={text:i.title,data:{id:i[d],cate_id:this[o],have_knowledge:void 0},state:{expanded:!1},childern:void 0};i.child?.list.length&&(l.children=this.formatterList(i.child.list)),i[d]&&((await s.Z.listNoPageKnowledge({equalFields:{[d]:i[d]},fields:["knowledge_id"]})).list.length>0?l.data.have_knowledge=!0:l.data.have_knowledge=!1),e.push(l)}return e},onSearch(t){let{listParams:e}=this;e.keyword=""===t?void 0:t,e.equalFields.parent_id="null",this.listParams={...e},this.list=[],this.setList()},onDelete(t){s.Z.deleteTreeKnowledgeCatalog([t]).then((()=>{this.$toast.success({message:"删除成功",onClose:()=>this.init()})}))},async onExpand(t){if(t.children.length>0&&void 0===t.children[0].data.text){let e={...this.listParams};e.keyword=void 0,e.equalFields.parent_id=t.data.id;let a=await s.Z.listNoPageKnowledgeCatalog(e),i=this.formatterList(a.list);t.children.find((t=>void 0===t.data.title)).remove(),i.forEach((e=>{t.append(e)}))}}}},r=(0,a(1900).Z)(n,i,[],!1,null,null,null).exports}}]);