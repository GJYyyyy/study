"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[245],{4245:(t,e,a)=>{a.r(e),a.d(e,{default:()=>l});var o=function(){var t=this,e=t._self._c;return e("div",[e("van-form",{on:{submit:t.onSubmit}},[e("van-field",{attrs:{value:t.majorList[t.majorListIndex]?.title,readonly:"","is-link":"",label:"专业",placeholder:"请选择专业",rules:[{required:!0,message:"请选择专业"}]},on:{click:t.onMajorPopupShow}}),t._v(" "),e("van-field",{attrs:{name:"科目",label:"科目",placeholder:"科目",rules:[{required:!0,message:"请填写科目"}]},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}}),t._v(" "),e("van-field",{attrs:{name:"科目代号",label:"科目代号",placeholder:"科目代号"},model:{value:t.formData.code,callback:function(e){t.$set(t.formData,"code",e)},expression:"formData.code"}}),t._v(" "),e("div",{staticStyle:{margin:"16px"}},[e("van-button",{attrs:{round:"",block:"",type:"info",size:"small","native-type":"submit"}},[t._v("提交")])],1)],1),t._v(" "),e("div",{staticStyle:{margin:"16px"}},[e("van-button",{attrs:{round:"",block:"",type:"danger",size:"small"},on:{click:t.onDeleteSubject}},[t._v("删除")])],1),t._v(" "),e("van-popup",{attrs:{position:"bottom"},model:{value:t.majorPopupVisible,callback:function(e){t.majorPopupVisible=e},expression:"majorPopupVisible"}},[e("van-picker",{attrs:{title:"选择专业","show-toolbar":"","value-key":"title","default-index":t.majorListIndex,columns:t.majorList},on:{confirm:t.onMajorConfirm,cancel:function(e){t.majorPopupVisible=!1}}})],1)],1)};o._withStripped=!0;var i=a(2996),s=a(1241);const r={data:()=>({formData:{title:"",code:"",major_id:""},majorPopupVisible:!1,majorList:[],majorListIndex:-1}),computed:{subject_id(){return this.$route.query.id}},async mounted(){let t=(await i.Z.listNoPageMajor()).list?.map((t=>({...t,_title:t.title,_code:t.code,title:t.code?`${t.title}(${t.code})`:t.title})));this.majorList=t;let e=await i.Z.detailSubject(this.subject_id),{formData:a}=this;a.title=e.data.title,a.code=e.data.code,a.major_id=e.data.major_id,this.formData={...a};let o=t.findIndex((t=>t.major_id===e.data.major_id));this.majorListIndex=o},methods:{onSubmit(){let t={...this.formData};t.major_id=this.majorList[this.majorListIndex]?.major_id,i.Z.updateSubject(this.subject_id,(0,s.mG)(t)).then((()=>{this.$toast.success({message:"更新成功",onClose:()=>this.$router.back()})}))},onDeleteSubject(){this.$dialog.confirm({message:"确认删除"}).then((()=>{i.Z.deleteSubject([this.subject_id]).then((()=>{this.$toast.success({message:"删除成功",onClose:()=>this.$router.back()})}))}))},onMajorPopupShow(){this.formData.major_id&&-1!==this.majorListIndex?this.$toast({message:"已指定父级，不能修改"}):this.majorPopupVisible=!0},onMajorConfirm(t,e){this.majorListIndex=e,this.majorPopupVisible=!1}}},l=(0,a(1900).Z)(r,o,[],!1,null,null,null).exports}}]);