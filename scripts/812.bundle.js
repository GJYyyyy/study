(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[812],{4545:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>l});var o=a(6738),n=a.n(o),i=a(7705),s=a.n(i)()(n());s.push([t.id,"\n.update-knowledge .btn-set[data-v-50857ffa] {\n    margin: 16px;\n}\n.update-knowledge .btn-set[data-v-50857ffa] .van-button {\n    width: calc(50% - 16px);\n}\n",""]);const l=s},812:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>h});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"update-knowledge"},[e("van-form",{on:{submit:t.onSubmit}},[e("van-field",{attrs:{label:"知识点目录",readonly:"",value:t.currentKnowledgeCatalogTitle,"is-link":""},on:{click:t.onCateKeyClick}}),t._v(" "),e("van-field",{attrs:{name:"标题",label:"标题",placeholder:"标题",rules:[{required:!0,message:"请填写标题"}]},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}}),t._v(" "),e("van-field",{attrs:{label:"内容",readonly:""}}),t._v(" "),t.initFormData.content?e("custome-markdown-editor",{attrs:{value:t.initFormData.content},on:{change:t.onMarkdownChange,save:t.onMarkdownSave,show:t.onMarkdownShow}}):t._e(),t._v(" "),e("div",{staticClass:"row-between btn-set"},[e("van-button",{attrs:{round:"",type:"danger",size:"small","native-type":"button"},on:{click:t.onDeleteKnowledge}},[t._v("删除")]),t._v(" "),e("van-button",{attrs:{round:"",color:t.collectionColor,size:"small","native-type":"button"},on:{click:t.onCollection}},[t._v(t._s(t.collectionText))])],1),t._v(" "),e("div",{staticStyle:{margin:"16px"}},[e("van-button",{attrs:{round:"",block:"",type:"info",size:"small","native-type":"submit",disabled:t.isSaved}},[t._v(t._s("提交"+(t.isSaved?"":"（未保存）")))])],1)],1)],1)};o._withStripped=!0;var n=a(3308),i=a(1241),s=a(9146);const l="knowledge_id",d="knowledge_catalog_id",r="knowledge_collection_id",c={components:{"custome-markdown-editor":s.NW},data:()=>({formData:{title:"",content:""},initFormData:{title:"",content:""},currentKnowledgeCatalogTitle:"",[d]:"",[r]:void 0}),computed:{[l](){return this.$route.query.id},collectionText(){return this[r]?"已收藏":"收藏"},collectionColor(){return this[r]?"var(--green)":"var(--gray-3)"},isSaved(){return this.formData.title===this.initFormData.title&&this.formData.content===this.initFormData.content}},async mounted(){this.init()},methods:{async init(){let t;(0,i.QP)();try{t=await n.Z.detailKnowledge(this.knowledge_id,{fields:["title","content",d]})}catch(t){(0,i.Zk)()}let e,a=decodeURIComponent(t.data.content)||" ",{formData:o,initFormData:s}=this;o.title=t.data.title,o.content=a,this.formData={...o},s.title=t.data.title,s.content=a,this.initFormData={...s},this[d]=t.data[d],this[r]=t.data[r];try{e=await n.Z.detailKnowledgeCatalog(t.data[d],{fields:["title"]})}catch(t){(0,i.Zk)()}this.currentKnowledgeCatalogTitle=e.data.title,(0,i.Zk)()},onSubmit(){if(!this.isSaved){let t={...this.formData};this.initFormData={...this.formData},t.content=encodeURIComponent(t.content),(0,i.QP)(),n.Z.updateKnowledge(this.knowledge_id,(0,i.mG)(t)).then((()=>{(0,i.Zk)(),this.$toast.success({message:"更新成功",onClose:()=>this.$router.push({path:"listKnowledge",query:{cate_id:this[d]}})})}),(()=>(0,i.Zk)()))}},onDeleteKnowledge(){this.$dialog.confirm({message:"确认删除"}).then((()=>{(0,i.QP)(),n.Z.deleteKnowledge([this.knowledge_id]).then((()=>{(0,i.Zk)(),this.$toast.success({message:"删除成功",onClose:()=>this.$router.push({path:"listKnowledge",query:{cate_id:this[d]}})})}),(()=>(0,i.Zk)()))}))},onMarkdownChange(t){let{formData:e}=this;e.content=t},onMarkdownSave(t){if(!this.isSaved){let e={...this.formData};this.initFormData={...this.formData},e.content=encodeURIComponent(t),(0,i.QP)(),n.Z.updateKnowledge(this.knowledge_id,(0,i.mG)(e)).then((()=>{(0,i.Zk)(),this.$toast.success({message:"保存成功"}),console.log(`%c 保存成功 "${this.formData.title}"-${(0,i.Bv)().format("HH:mm:ss")}`,"color: green;font-size:20px;")}),(()=>(0,i.Zk)()))}},onMarkdownShow(){this.$router.push({path:"/detailKnowledge",query:{id:this.knowledge_id}})},async onCollection(){(0,i.QP)(),this[r]?(await n.Z.deleteKnowledgeCollection([this[r]]),this.$toast.success("取消收藏成功"),this.init()):(await n.Z.addKnowledgeCollection({[l]:this.knowledge_id}),this.$toast.success("收藏成功"),this.init()),(0,i.Zk)()},onCateKeyClick(){this.$router.push({path:"/listKnowledgeCatalog",query:{expand_cate_id:this[d]}})}}};a(5815);const h=(0,a(1900).Z)(c,o,[],!1,null,"50857ffa",null).exports},5815:(t,e,a)=>{var o=a(4545);o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[t.id,o,""]]),o.locals&&(t.exports=o.locals);var n=(0,a(4023).Z)("03a448c9",o,!1,{});o.locals||t.hot.accept(4545,(function(){var e=a(4545);e.__esModule&&(e=e.default),"string"==typeof e&&(e=[[t.id,e,""]]),n(e)})),t.hot.dispose((function(){n()}))}}]);