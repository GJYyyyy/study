"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[66],{9066:(t,e,a)=>{a.r(e),a.d(e,{default:()=>o});var i=function(){var t=this,e=t._self._c;return e("div",[e("add-button",{attrs:{path:"/addKnowledgeCatalog",query:t.addtionQuery}}),t._v(" "),e("custom-list-head",{attrs:{title:"科目",value:t.cateTitle}}),t._v(" "),e("custom-tree",{attrs:{list:t.list,"child-list-path":"/listKnowledge","update-path":"/updateKnowledgeCatalog","add-path":"/addKnowledgeCatalog"},on:{delete:t.onDelete,expand:t.onExpand}}),t._v(" "),e("custom-search",{on:{search:t.onSearch}})],1)};i._withStripped=!0;var s=a(3308),l=a(1241),d=a(3485);const r="subject_id",n={components:{"add-button":d.HS,"custom-tree":d.Uh,"custom-search":d.Ny,"custom-list-head":d.K4},computed:{[r](){return this.$route.query.cate_id||this.$store.state.userInfo[r]},addtionQuery(){return{cate_id:this[r]}}},data:()=>({cateTitle:"",list:[],listParams:{keyword:void 0,equalFields:{[r]:"",parent_id:"null"}}}),async mounted(){this.init()},methods:{async getList(){let t;(0,l.QP)();try{t=await s.Z.listNoPageKnowledgeCatalog(this.listParams)}catch(t){(0,l.Zk)()}return(0,l.Zk)(),t},async setList(){let t=await this.getList();this.list=this.formatterList(t.list)},async init(){let t;(0,l.QP)();try{t=await s.Z.detailSubject(this[r],{fields:["title","code"]})}catch(t){(0,l.Zk)()}this.cateTitle=t.data.code?`${t.data.title}(${t.data.code})`:t.data.title;let{listParams:e}=this;e.equalFields[r]=this[r],e.equalFields.parent_id="null",e.keyword=void 0,this.listParams={...e},this.list=[],this.setList()},formatterList(t){return t.sort(((t,e)=>t.create_date-e.create_date)).map((t=>{let e={text:t.title,data:{id:t.knowledge_catalog_id,cate_id:this[r]},state:{expanded:!1}};return t.child?.list.length&&(e.children=this.formatterList(t.child.list)),e}))},onSearch(t){let{listParams:e}=this;e.keyword=""===t?void 0:t,e.equalFields.parent_id="null",this.listParams={...e},this.list=[],this.setList()},onDelete(t){(0,l.QP)(),s.Z.deleteTreeKnowledgeCatalog([t]).then((()=>{(0,l.Zk)(),this.$toast.success({message:"删除成功",onClose:()=>this.init()})}),(()=>(0,l.Zk)()))},async onExpand(t){if(t.children.length>0&&void 0===t.children[0].data.text){let e,a={...this.listParams};a.keyword=void 0,a.equalFields.parent_id=t.data.id,(0,l.QP)();try{e=await s.Z.listNoPageKnowledgeCatalog(a)}catch(t){(0,l.Zk)()}let i=this.formatterList(e.list);t.children.find((t=>void 0===t.data.title)).remove(),i.forEach((e=>{t.append(e)})),(0,l.Zk)()}}}},o=(0,a(1900).Z)(n,i,[],!1,null,null,null).exports}}]);